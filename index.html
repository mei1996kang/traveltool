<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 é—œè¥¿æ—…èªŒ V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Noto+Sans+TC:wght@300;500;700&display=swap');
        body { font-family: 'Noto Sans TC', 'Noto Sans JP', sans-serif; background-color: #fcfcfc; color: #2c3e50; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .day-title { font-size: 1.5rem; font-weight: 700; border-left: 6px solid #1a2a6c; padding-left: 12px; margin-bottom: 20px; }
        .day-btn.active { border: 2px solid #1a2a6c; color: #1a2a6c; font-weight: 700; background: #f0f2f8; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
        .modal-content { background: white; margin: 10% auto; padding: 20px; width: 90%; max-width: 500px; border-radius: 16px; position: relative; max-height: 80vh; overflow-y: auto; }
        .timeline-line { border-left: 2px solid #eef0f2; margin-left: 10px; padding-left: 20px; position: relative; }
        .timeline-dot { position: absolute; left: -6px; top: 8px; width: 10px; height: 10px; background: #cbd5e1; border-radius: 50%; }
    </style>
</head>
<body class="pb-28">

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-md p-5 sticky top-0 z-50 border-b border-gray-100 flex justify-between items-center">
        <div>
            <div class="text-[9px] text-gray-400 tracking-[0.3em] font-light uppercase">Osaka Trip</div>
            <h1 class="text-sm font-bold tracking-widest">å¤§é˜ª â— äº¬éƒ½ â— å…µåº« 2026</h1>
        </div>
        <i class="fas fa-map-marked-alt text-indigo-100 text-2xl"></i>
    </header>

    <!-- è©³æƒ…å½ˆçª— -->
    <div id="infoModal" class="modal" onclick="closeModal()">
        <div class="modal-content shadow-2xl" onclick="event.stopPropagation()">
            <button class="absolute top-4 right-4 text-gray-400 z-10" onclick="closeModal()"><i class="fas fa-times-circle text-2xl"></i></button>
            <div id="modal-body" class="space-y-4"></div>
        </div>
    </div>

    <!-- 1. è¡Œç¨‹é ç±¤ -->
    <div id="itinerary" class="tab-content active p-5">
        <div class="flex space-x-3 overflow-x-auto mb-6 pb-2 hide-scrollbar">
            <button onclick="showDay(1)" class="day-btn border px-5 py-2 rounded-lg text-xs min-w-fit bg-white">2/2 Mon</button>
            <button onclick="showDay(2)" class="day-btn border px-5 py-2 rounded-lg text-xs min-w-fit bg-white">2/3 Tue</button>
            <button onclick="showDay(3)" class="day-btn border px-5 py-2 rounded-lg text-xs min-w-fit bg-white">2/4 Wed</button>
            <button onclick="showDay(4)" class="day-btn border px-5 py-2 rounded-lg text-xs min-w-fit bg-white">2/5 Thu</button>
            <button onclick="showDay(5)" class="day-btn border px-5 py-2 rounded-lg text-xs min-w-fit bg-white">2/6 Fri</button>
        </div>

        <div id="weather-section" class="bg-white border rounded-xl p-5 mb-8 shadow-sm">
            <div class="flex justify-between items-end mb-4">
                <h2 id="weather-city" class="text-xl font-bold tracking-tighter">è¼‰å…¥ä¸­...</h2>
                <div id="current-temp" class="text-3xl font-light">--Â°</div>
            </div>
            <div id="hourly-weather" class="flex space-x-6 overflow-x-auto pb-2 hide-scrollbar"></div>
        </div>

        <div id="day-title" class="day-title"></div>
        <div id="day-content" class="space-y-1"></div>
    </div>

    <!-- 2. ä»£è³¼æ¸…å–® -->
    <div id="shopping" class="tab-content p-5">
        <div class="bg-white p-6 border rounded-xl mb-6 shadow-sm">
            <h3 class="font-bold text-xs mb-4 tracking-widest border-b pb-2 uppercase text-gray-400">Add Item</h3>
            <div class="space-y-4">
                <input type="text" id="shop-name" placeholder="å•†å“åç¨±" class="w-full border-b py-2 text-sm outline-none">
                <input type="text" id="shop-loc" placeholder="é è¨ˆè³¼è²·åœ°é»" class="w-full border-b py-2 text-sm outline-none">
                <label class="block bg-gray-50 border border-dashed border-gray-300 py-6 text-center rounded-lg cursor-pointer">
                    <span id="shop-img-status" class="text-xs text-gray-400">ä¸Šå‚³å•†å“ç…§ç‰‡ (æœƒè‡ªå‹•å£“ç¸®)</span>
                    <input type="file" accept="image/*" class="hidden" onchange="processImage(this, 'shop')">
                </label>
                <button onclick="addShoppingItem()" class="w-full bg-slate-800 text-white py-3 rounded-lg text-xs tracking-widest">æ–°å¢è‡³æ¸…å–®</button>
            </div>
        </div>
        <div id="shopping-list" class="grid grid-cols-1 gap-3"></div>
    </div>

    <!-- 3. è¨˜å¸³å·¥å…· -->
    <div id="ledger" class="tab-content p-5">
        <div class="bg-white p-6 border rounded-xl mb-6 shadow-sm">
            <h3 class="font-bold text-xs mb-4 border-b pb-2 tracking-widest uppercase text-gray-400">Expense</h3>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <input type="text" id="exp-name" placeholder="é …ç›®" class="border-b py-2 text-sm outline-none">
                <input type="number" id="exp-amount" placeholder="é‡‘é¡ (Â¥)" class="border-b py-2 text-sm outline-none">
            </div>
            <div class="grid grid-cols-2 gap-4 mb-4">
                <select id="exp-method" class="border-b py-2 text-sm bg-transparent outline-none">
                    <option>ç¾é‡‘</option><option>åˆ·å¡</option><option>Suica</option>
                </select>
                <input type="date" id="exp-date" class="border-b py-2 text-sm outline-none bg-transparent">
            </div>
            <button onclick="addExpense()" class="w-full bg-slate-800 text-white py-3 rounded-lg text-xs tracking-widest">å„²å­˜æ”¯å‡º</button>
        </div>
        <div id="expense-list" class="space-y-2"></div>
        <div id="total-amount" class="mt-6 text-right font-light text-lg">Total <span class="text-3xl font-bold ml-1 text-red-600">Â¥0</span></div>
    </div>

    <!-- 4. æ–‡ä»¶/èˆªç­ -->
    <div id="tickets" class="tab-content p-5">
        <div class="bg-slate-900 text-white p-6 rounded-2xl mb-6 shadow-xl relative overflow-hidden">
            <div class="text-[10px] opacity-40 tracking-[0.4em] mb-4">FLIGHT</div>
            <div class="flex justify-between items-center mb-4">
                <div class="text-center"><div class="text-2xl font-bold">TPE</div><div class="text-[9px] opacity-50">09:20</div></div>
                <div class="flex-1 border-b border-dashed border-white/20 mx-4 relative"><i class="fas fa-plane absolute -top-2 left-1/2 -translate-x-1/2 text-xs"></i></div>
                <div class="text-center"><div class="text-2xl font-bold">KIX</div><div class="text-[9px] opacity-50">12:50</div></div>
            </div>
            <div class="text-[10px] opacity-60 text-center">STARLUX AIRLINES JX822 / JX821</div>
        </div>

        <div class="bg-white p-5 border rounded-xl mb-6 shadow-sm">
            <h3 class="font-bold text-[10px] tracking-widest mb-4 border-b pb-2 text-gray-400 uppercase">Accommodations</h3>
            <div class="space-y-4">
                <div class="flex justify-between items-center" onclick="navigate('GRIDS PREMIUM HOTEL OSAKA NAMBA')">
                    <div class="text-sm">é›£æ³¢æ ¼åˆ©èŒ² GRIDS<div class="text-[10px] text-gray-400">Check-in: 2/2</div></div>
                    <i class="fas fa-location-arrow text-blue-500 text-xs"></i>
                </div>
                <div class="flex justify-between items-center" onclick="navigate('Hotel Hankyu RESPIRE OSAKA')">
                    <div class="text-sm">æ¢…ç”°é¾ä»•æŸ RESPIRE<div class="text-[10px] text-gray-400">Check-in: 2/3 - 2/6</div></div>
                    <i class="fas fa-location-arrow text-blue-500 text-xs"></i>
                </div>
            </div>
        </div>

        <div class="bg-white p-5 border rounded-xl shadow-sm">
            <h3 class="font-bold text-[10px] tracking-widest mb-4 text-gray-400 uppercase">Documents</h3>
            <input type="text" id="doc-name" placeholder="æ–‡ä»¶æ¨™é¡Œ" class="w-full border-b py-2 mb-4 text-sm outline-none">
            <label class="block border border-dashed border-gray-300 rounded-lg py-6 text-center text-xs text-gray-400 mb-4 cursor-pointer">
                <span id="doc-img-status">ä¸Šå‚³ç¥¨åˆ¸ç…§ç‰‡</span>
                <input type="file" accept="image/*" class="hidden" onchange="processImage(this, 'doc')">
            </label>
            <button onclick="addDoc()" class="w-full bg-slate-800 text-white py-3 rounded-lg text-xs tracking-widest">UPLOAD</button>
            <div id="doc-list" class="mt-6 space-y-3"></div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-100 flex justify-around p-4 safe-area-bottom z-50">
        <button onclick="switchTab('itinerary')" class="nav-btn flex flex-col items-center"><i class="fas fa-stream text-lg"></i><span class="text-[9px] mt-1">PLAN</span></button>
        <button onclick="switchTab('shopping')" class="nav-btn flex flex-col items-center"><i class="fas fa-shopping-cart text-lg"></i><span class="text-[9px] mt-1">SHOP</span></button>
        <button onclick="switchTab('ledger')" class="nav-btn flex flex-col items-center"><i class="fas fa-calculator text-lg"></i><span class="text-[9px] mt-1">CASH</span></button>
        <button onclick="switchTab('tickets')" class="nav-btn flex flex-col items-center"><i class="fas fa-layer-group text-lg"></i><span class="text-[9px] mt-1">DOCS</span></button>
    </nav>

    <script>
        // --- è¡Œç¨‹è³‡æ–™ (æ›´æ–°ç‰ˆ) ---
        const travelData = {
            1: { city: "å¤§é˜ª", title: "Day 1ï½œæŠµé”æ—¥æœ¬ â— è‡¨ç©ºåŸ", items: [
                { t: "06:00", d: "ä½å®¶ â†’ æ©Ÿæ·å°åŒ—è»Šç«™", m: "è¨ˆç¨‹è»Š", r: "é–‹å§‹æ—…ç¨‹" },
                { t: "09:20", d: "âœˆï¸ æ˜Ÿå®‡èˆªç©º JX822 èµ·é£›", m: "æ¡ƒåœ’ TPE", r: "ææ—©å ±åˆ°" },
                { t: "12:50", d: "æŠµé”é—œè¥¿æ©Ÿå ´ (KIX)", m: "å…¥å¢ƒ", r: "é ˜å–è¡Œæ" },
                { t: "13:56", d: "ğŸ›ï¸ è‡¨ç©ºåŸ OUTLET", m: "å—æµ·é›»éµ", r: "å‰å¾€ Rinku Town", detail: { 
                    img: "https://images.unsplash.com/photo-1605152276897-4f4998993c82?q=80&w=500&auto=format",
                    desc: "é—œè¥¿æœ€å¤§ Outletsï¼Œæ“æœ‰ 250 é–“åº—ã€‚å¿…è²·ï¼šè¥¿æ¾å±‹ã€Colemanã€Onitsuka Tigerã€‚<br><br><a href='https://www.premiumoutlets.co.jp/rinku/brands/pdf/rinku.pdf' target='_blank' class='text-blue-500 underline'>[é»æ­¤æ‰“é–‹ Outlet å®˜ç¶²åœ°åœ–é€£çµ]</a>"
                }},
                { t: "19:25", d: "ğŸ¨ é›£æ³¢ GRIDS å…¥ä½", m: "å¾’æ­¥", r: "å—æµ·é›£æ³¢ç«™æ—" }
            ]},
            2: { city: "å¤©æ©‹ç«‹", title: "Day 2ï½œæµ·ä¹‹äº¬éƒ½ä¸€æ—¥éŠ", items: [
                { t: "07:15", d: "ğŸšŒ KKDAY å·´å£«å‡ºç™¼", m: "èŸ¹é“æ¨‚æ±åº—é›†åˆ", r: "æº–æ™‚å‡ºç™¼" },
                { t: "10:00", d: "ğŸš¢ ä¼Šæ ¹ç£éŠè¦½èˆ¹", m: "æ™¯é»", r: "æ¬£è³èˆŸå±‹", detail: {
                    img: "https://images.unsplash.com/photo-1542931287-023b922fa89b?q=80&w=500&auto=format",
                    desc: "<b>ä¼Šæ ¹èˆŸå±‹</b>ï¼šæ—¥æœ¬æœ€ç¾æ‘èŠä¹‹ä¸€ã€‚ä¸€æ¨“ç‚ºèˆ¹å€‰ï¼ŒäºŒæ¨“ç‚ºä½å®¶ã€‚æ­ä¹˜éŠè¦½èˆ¹å¯ä»¥é¤µæµ·é·—ä¸¦å¾æµ·é¢ä¸Šæ‹æ”èˆŸå±‹ç¾¤ã€‚"
                }},
                { t: "11:00", d: "ğŸš  å¤©æ©‹ç«‹å‚˜æ¾å…¬åœ’", m: "æ™¯é»", r: "å€’é ­æ ½çœ‹ç¾æ™¯", detail: {
                    img: "https://images.unsplash.com/photo-1570191935694-8116262453c5?q=80&w=500&auto=format",
                    desc: "<b>å¤©æ©‹ç«‹</b>ï¼šæ—¥æœ¬ä¸‰æ™¯ä¹‹ä¸€ã€‚æ­ä¹˜å–®è»Œé›»è»Šå‰å¾€å‚˜æ¾å…¬åœ’ï¼ŒèƒŒå°æ²™æ´²å½è…°å¾èƒ¯ä¸‹çœ‹å»ï¼Œæ²™æ´²åƒä¸€æ¢é£›å¾€å¤©ç©ºçš„é¾ã€‚"
                }},
                { t: "14:45", d: "ğŸ¡ ç¾å±±èŒ…è‰å±‹ä¹‹é‡Œ", m: "æ™¯é»", r: "åŸå§‹å»ºç¯‰", detail: {
                    img: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=500&auto=format",
                    desc: "<b>ç¾å±±åˆæŒæ‘</b>ï¼šèˆ‡ç™½å·é„‰é½Šåçš„èŒ…è‰å±‹èšè½ï¼Œä¿ç•™æ¿ƒéƒçš„æ—¥æœ¬è¾²æ‘é¢¨æ™¯ã€‚"
                }},
                { t: "19:00", d: "ğŸ¨ æ¢…ç”° RESPIRE å…¥ä½", m: "å¾’æ­¥", r: "ä½æ–¼æ¢…ç”°ç«™ä¸­å¿ƒ" }
            ]},
            3: { city: "äº¬éƒ½", title: "Day 3ï½œè²´èˆ¹ç¥ç¤¾èˆ‡æ°´å åœ", items: [
                { t: "12:40", d: "æ¢…ç”° â†’ è²´èˆ¹ (å»ç¨‹)", m: "äº¤é€š", r: "è½‰ä¹˜æ”»ç•¥", detail: {
                    desc: "<b>ã€æ¢…ç”°è‡³è²´èˆ¹è½‰ä¹˜å»ºè­°ã€‘</b><br>1. <b>åœ°éµå¾¡å ‚ç­‹ç·š</b>ï¼šæ¢…ç”°ç«™ â†’ æ·€å±‹æ©‹ç«™ (2min)<br>2. <b>äº¬é˜ªæœ¬ç·š</b>ï¼šæ·€å±‹æ©‹ç«™ â†’ å‡ºç”ºæŸ³ç«™ (55min)<br>3. <b>å¡å±±é›»è»Š</b>ï¼šå‡ºç”ºæŸ³ç«™ â†’ è²´èˆ¹å£ç«™ (30min)<br>4. <b>äº¬éƒ½å·´å£«33è·¯</b>ï¼šè²´èˆ¹å£ â†’ è²´èˆ¹ (5min)"
                }},
                { t: "14:40", d: "â›©ï¸ è²´èˆ¹ç¥ç¤¾åƒæ‹œ", m: "å¾’æ­¥", r: "æ°´å åœèˆ‡é»ç‡ˆ", detail: {
                    desc: "å¤å­£æœ‰æ°´å åœï¼Œå†¬å­£é›ªæ™¯èˆ‡ç´…è‰²é³¥å±…çš„å¼·çƒˆå°æ¯”éå¸¸ç¾ã€‚å‚æ™šåƒé“å…©æ—çš„ç´…ç‡ˆç± æœƒäº®èµ·ã€‚"
                }},
                { t: "19:10", d: "è²´èˆ¹ â†’ æ¢…ç”° (å›ç¨‹)", m: "äº¤é€š", r: "åŸè·¯è¿”å›", detail: {
                    desc: "ä¾æ“šå»ç¨‹æ–¹å¼åŸè·¯è¿”å›ï¼Œæˆ–æ­ä¹˜äº¬é˜ªé›»è»Šè‡³ã€æ·€å±‹æ©‹ã€è½‰åœ°éµå›æ¢…ç”°ã€‚"
                }},
                { t: "20:30", d: "ğŸ¥© æ™šé¤ï¼šç‡’è‚‰åŠ›ä¸¸", m: "å¾’æ­¥", r: "æ¢…ç”°åº—" }
            ]},
            4: { city: "å§¬è·¯", title: "Day 4ï½œå‹å°¾å¯º â— å§¬è·¯åŸ", items: [
                { t: "08:05", d: "æ¢…ç”° â†’ å‹å°¾å¯º (äº¤é€š)", m: "äº¤é€š", r: "è½‰ä¹˜æ”»ç•¥", detail: {
                    desc: "<b>ã€å‰å¾€å‹å°¾å¯ºã€‘</b><br>1. <b>åœ°éµå¾¡å ‚ç­‹ç·š</b>ï¼šæ¢…ç”°ç«™ â†’ åƒé‡Œä¸­å¤®ç«™ (20min)<br>2. <b>é˜ªæ€¥å·´å£« 29è·¯</b>ï¼šåƒé‡Œä¸­å¤®ç«™ 4è™Ÿæœˆå° â†’ å‹å°¾å¯ºç«™ (30min)ã€‚"
                }},
                { t: "09:10", d: "ğŸ”´ å‹å°¾å¯ºåƒæ‹œ", m: "å¾’æ­¥", r: "é”æ‘©ä¸å€’ç¿", detail: {
                    desc: "ç¥ˆæ±‚å‹é‹çš„å¯ºå»Ÿï¼Œåˆ°è™•éƒ½æ˜¯ä¿¡çœ¾ç•™ä¸‹çš„ã€è´éŒ¢ä¸å€’ç¿ (é”æ‘©)ã€ï¼Œéå¸¸å£¯è§€ã€‚"
                }},
                { t: "12:20", d: "æ¢…ç”° â†’ å§¬è·¯ (äº¤é€š)", m: "äº¤é€š", r: "è½‰ä¹˜æ”»ç•¥", detail: {
                    desc: "<b>ã€å‰å¾€å§¬è·¯åŸã€‘</b><br>1. å¾ã€å¤§é˜ªæ¢…ç”°ç«™ã€æ­ä¹˜ <b>JR æ–°å¿«é€Ÿ</b> ç›´é”ã€å§¬è·¯ç«™ã€(ç´„65min)ã€‚<br>2. å§¬è·¯ç«™ä¸‹è»Šå¾Œæ­¥è¡Œç´„15åˆ†é˜å³å¯æŠµé”åŸå ¡ã€‚"
                }},
                { t: "13:35", d: "ğŸ¯ å§¬è·¯åŸåƒè§€", m: "å¾’æ­¥", r: "ç™½é·ºåŸ", detail: {
                    desc: "æ—¥æœ¬ä¿å­˜æœ€å®Œå¥½çš„åŸå ¡ï¼Œåœ‹å¯¶ç´šå»ºç¯‰ã€‚ç´”ç™½çš„å»ºç¯‰å¤–è§€è¢«è­½ç‚ºç™½é·ºåŸã€‚"
                }}
            ]},
            5: { city: "å¤§é˜ª", title: "Day 5ï½œé£¯åº—æ—©é¤ â— è³¦æ­¸", items: [
                { t: "07:00", d: "ğŸ¥ é£¯åº—æ—©é¤æ™‚é–“", m: "é£¯åº—", r: "Umeda Respire" },
                { t: "08:00", d: "ğŸš æ¥é€è‡³é—œè¥¿æ©Ÿå ´", m: "KKDAY", r: "æå‰3å°æ™‚å ±åˆ°" },
                { t: "12:20", d: "âœˆï¸ é—œè¥¿æ©Ÿå ´èµ·é£›", m: "JX821", r: "è¿”å°" }
            ]}
        };

        const cityCoords = { "å¤§é˜ª": { lat: 34.69, lon: 135.50 }, "å¤©æ©‹ç«‹": { lat: 35.55, lon: 135.19 }, "äº¬éƒ½": { lat: 35.01, lon: 135.76 }, "å§¬è·¯": { lat: 34.81, lon: 134.69 } };

        // --- æ ¸å¿ƒé‚è¼¯ (å¤©æ°£ã€è©³æƒ…ã€åœ–ç‰‡å£“ç¸®) ---

        async function fetchWeather(cityName) {
            const coord = cityCoords[cityName] || cityCoords["å¤§é˜ª"];
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${coord.lat}&longitude=${coord.lon}&hourly=temperature_2m,weathercode&timezone=Asia%2FTokyo&forecast_days=1`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                document.getElementById('weather-city').innerText = cityName;
                document.getElementById('current-temp').innerText = Math.round(data.hourly.temperature_2m[new Date().getHours()]) + 'Â°';
                renderHourly(data);
            } catch (e) { console.error("W-Error"); }
        }

        function renderHourly(data) {
            document.getElementById('hourly-weather').innerHTML = data.hourly.temperature_2m.slice(0, 24).filter((_, i) => i % 2 === 0).map((temp, i) => `
                <div class="min-w-[45px] text-center">
                    <div class="text-[9px] text-gray-400 mb-2">${i*2}:00</div>
                    <div class="text-sm mb-2">${getWIcon(data.hourly.weathercode[i*2])}</div>
                    <div class="text-xs font-bold">${Math.round(temp)}Â°</div>
                </div>
            `).join('');
        }

        function getWIcon(c) { return c === 0 ? 'â˜€ï¸' : c <= 3 ? 'ğŸŒ¤ï¸' : 'â˜ï¸'; }

        function showDay(day) {
            const data = travelData[day];
            fetchWeather(data.city);
            document.getElementById('day-title').innerText = data.title;
            document.getElementById('day-content').innerHTML = data.items.map((it, idx) => `
                <div class="timeline-line pb-6" onclick="openDetail(${day}, ${idx})">
                    <div class="timeline-dot"></div>
                    <div class="flex justify-between items-start">
                        <div class="text-[10px] font-bold text-gray-400 w-12 pt-1 uppercase">${it.t}</div>
                        <div class="flex-1">
                            <div class="text-sm font-medium flex items-center">
                                ${it.d}
                                <i class="fas fa-map-marker-alt text-red-500 ml-2 text-[10px]" onclick="event.stopPropagation(); navigate('${it.d}')"></i>
                                <i class="fas fa-chevron-right text-gray-200 ml-auto text-[10px]"></i>
                            </div>
                            <div class="text-[10px] text-gray-400 mt-0.5">
                                <span class="bg-indigo-50 text-indigo-400 px-1 mr-2 rounded">${it.m}</span>${it.r}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            document.querySelectorAll('.day-btn').forEach((b, i) => b.classList.toggle('active', i+1===day));
        }

        function openDetail(day, idx) {
            const item = travelData[day].items[idx];
            if (!item.detail) return;
            document.getElementById('modal-body').innerHTML = `
                ${item.detail.img ? `<img src="${item.detail.img}" class="w-full h-48 object-cover rounded-xl shadow-inner">` : ''}
                <div class="p-2">
                    <h4 class="font-bold text-xl mb-3">${item.d}</h4>
                    <p class="text-sm text-gray-600 leading-relaxed">${item.detail.desc}</p>
                    <button onclick="navigate('${item.d}')" class="w-full bg-slate-100 text-slate-800 py-4 rounded-xl text-xs font-bold mt-6 tracking-widest">
                        <i class="fas fa-location-arrow mr-2"></i> é–‹å•Ÿåœ°åœ–å°è¦½
                    </button>
                </div>
            `;
            document.getElementById('infoModal').style.display = 'block';
        }

        function closeModal() { document.getElementById('infoModal').style.display = 'none'; }

        // --- ä»£è³¼ & è¨˜å¸³ å„²å­˜é‚è¼¯ (å«åˆªé™¤) ---

        let shops = JSON.parse(localStorage.getItem('trip_shop_v6')) || [];
        let exps = JSON.parse(localStorage.getItem('trip_exp_v6')) || [];
        let tempImg = null;

        function processImage(input, key) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 500; canvas.height = (img.height/img.width)*500;
                    ctx.drawImage(img, 0, 0, 500, canvas.height);
                    tempImg = canvas.toDataURL('image/jpeg', 0.5);
                    document.getElementById(`${key}-img-status`).innerText = "âœ… åœ–ç‰‡å·²å°±ç·’";
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function addShoppingItem() {
            const name = document.getElementById('shop-name').value;
            if(!name) return alert("è«‹è¼¸å…¥å•†å“åç¨±");
            shops.unshift({ id: Date.now(), name, loc: document.getElementById('shop-loc').value, img: tempImg });
            localStorage.setItem('trip_shop_v6', JSON.stringify(shops));
            renderShopping();
            document.getElementById('shop-name').value = ''; tempImg = null;
        }

        function renderShopping() {
            document.getElementById('shopping-list').innerHTML = shops.map(s => `
                <div class="bg-white p-3 rounded-xl border flex items-center gap-4 shadow-sm">
                    <div class="w-14 h-14 bg-gray-100 rounded-lg bg-cover bg-center flex-shrink-0" style="background-image:url(${s.img || ''})"></div>
                    <div class="flex-1">
                        <div class="text-sm font-bold">${s.name}</div>
                        <div class="text-[10px] text-gray-400">${s.loc}</div>
                    </div>
                    <button onclick="delShop(${s.id})" class="text-gray-300 p-2"><i class="fas fa-trash-alt"></i></button>
                </div>
            `).join('');
        }
        function delShop(id) { shops = shops.filter(s => s.id !== id); localStorage.setItem('trip_shop_v6', JSON.stringify(shops)); renderShopping(); }

        function addExpense() {
            const name = document.getElementById('exp-name').value;
            const amt = document.getElementById('exp-amount').value;
            if(!name || !amt) return;
            exps.unshift({ id: Date.now(), name, amt, method: document.getElementById('exp-method').value, date: document.getElementById('exp-date').value });
            localStorage.setItem('trip_exp_v6', JSON.stringify(exps));
            renderLedger();
        }
        function renderLedger() {
            let total = 0;
            document.getElementById('expense-list').innerHTML = exps.map(e => {
                total += Number(e.amt);
                return `<div class="bg-white p-4 border-b flex justify-between items-center">
                    <div class="text-xs font-bold">${e.name} <span class="text-[9px] font-normal text-gray-400">(${e.method})</span></div>
                    <div class="flex items-center gap-4"><span class="font-bold">Â¥${e.amt}</span><button onclick="delExp(${e.id})" class="text-gray-200">âœ•</button></div>
                </div>`;
            }).join('');
            document.querySelector('#total-amount span').innerText = `Â¥${total}`;
        }
        function delExp(id) { exps = exps.filter(e => e.id !== id); localStorage.setItem('trip_exp_v6', JSON.stringify(exps)); renderLedger(); }

        // æ–‡ä»¶ä¸Šå‚³ä¿®æ­£
        let docs = JSON.parse(localStorage.getItem('trip_doc_v6')) || [];
        function addDoc() {
            const n = document.getElementById('doc-name').value;
            if(!n || !tempImg) return;
            docs.unshift({ id: Date.now(), name: n, img: tempImg });
            localStorage.setItem('trip_doc_v6', JSON.stringify(docs));
            renderDocs();
        }
        function renderDocs() {
            document.getElementById('doc-list').innerHTML = docs.map(d => `
                <div class="bg-white p-4 border rounded-xl flex justify-between items-center">
                    <div class="text-xs font-bold">${d.name}</div>
                    <div class="flex gap-4"><button onclick="viewImg('${d.img}')" class="text-indigo-500 font-bold text-xs">VIEW</button><button onclick="delDoc(${d.id})" class="text-gray-200">âœ•</button></div>
                </div>
            `).join('');
        }
        function delDoc(id) { docs = docs.filter(d => d.id !== id); localStorage.setItem('trip_doc_v6', JSON.stringify(docs)); renderDocs(); }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(t).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('text-slate-800', b.getAttribute('onclick').includes(t)));
        }

        function viewImg(src) { const w = window.open(""); w.document.write(`<img src="${src}" style="width:100%">`); }
        function navigate(l) { window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(l)}`, '_blank'); }

        // åˆå§‹åŒ–
        showDay(1); renderShopping(); renderLedger(); renderDocs();
        document.getElementById('exp-date').valueAsDate = new Date();
    </script>
</body>
</html>