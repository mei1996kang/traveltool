<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 é—œè¥¿ä¹‹æ—…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-gray-50 pb-20">

    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 sticky top-0 z-50 shadow-md">
        <h1 id="page-title" class="text-xl font-bold text-center">æ¯æ—¥è¡Œç¨‹</h1>
    </header>

    <!-- 1. è¡Œç¨‹é é¢ -->
    <div id="itinerary" class="tab-content active p-4">
        <!-- æ—¥æœŸåˆ‡æ›æŒ‰éˆ• -->
        <div class="flex space-x-2 overflow-x-auto mb-4 pb-2">
            <button onclick="showDay(1)" class="day-btn bg-blue-100 px-4 py-2 rounded-full text-sm font-bold min-w-fit">2/2 (ä¸€)</button>
            <button onclick="showDay(2)" class="day-btn bg-white px-4 py-2 rounded-full text-sm min-w-fit border">2/3 (äºŒ)</button>
            <button onclick="showDay(3)" class="day-btn bg-white px-4 py-2 rounded-full text-sm min-w-fit border">2/4 (ä¸‰)</button>
            <button onclick="showDay(4)" class="day-btn bg-white px-4 py-2 rounded-full text-sm min-w-fit border">2/5 (å››)</button>
            <button onclick="showDay(5)" class="day-btn bg-white px-4 py-2 rounded-full text-sm min-w-fit border">2/6 (äº”)</button>
        </div>

        <!-- è¡Œç¨‹æ¸…å–® (ç¯„ä¾‹é¡¯ç¤ºç¬¬ä¸€å¤©) -->
        <div id="day-content">
            <!-- ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>

    <!-- 2. èˆªç­/ç¥¨åˆ¸é é¢ -->
    <div id="tickets" class="tab-content p-4">
        <div class="bg-white p-4 rounded-xl shadow mb-4">
            <h3 class="font-bold border-b pb-2 mb-2"><i class="fas fa-plane"></i> èˆªç­è³‡è¨Š</h3>
            <p class="text-sm">å»ç¨‹ï¼šæ˜Ÿå®‡ JX822 (09:20 TPE â†’ 12:50 KIX)</p>
            <p class="text-sm text-gray-600">å›ç¨‹ï¼šæ˜Ÿå®‡ JX821 (12:20 KIX â†’ 14:35 TPE)</p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow mb-4">
            <h3 class="font-bold border-b pb-2 mb-2"><i class="fas fa-hotel"></i> é£¯åº—è³‡è¨Š</h3>
            <p class="text-sm">2/2: GRIDS PREMIUM HOTEL OSAKA NAMBA</p>
            <p class="text-sm">2/3-2/6: Hotel Hankyu RESPIRE OSAKA</p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow">
            <h3 class="font-bold border-b pb-2 mb-2"><i class="fas fa-ticket-alt"></i> ç¥¨åˆ¸/æ–‡ä»¶åº«</h3>
            <input type="file" id="ticket-upload" class="hidden" onchange="saveDoc(this)">
            <button onclick="document.getElementById('ticket-upload').click()" class="bg-gray-100 w-full py-3 rounded text-sm mb-2 text-gray-600">+ ä¸Šå‚³ç¥¨åˆ¸æˆªåœ– (å­˜æ–¼æœ¬åœ°)</button>
            <div id="doc-list" class="grid grid-cols-2 gap-2"></div>
        </div>
    </div>

    <!-- 3. è¨˜å¸³å·¥å…· -->
    <div id="ledger" class="tab-content p-4">
        <div class="bg-white p-4 rounded-xl shadow mb-4">
            <h3 class="font-bold mb-3">æ–°å¢æ”¯å‡º (æ—¥å¹£ JPY)</h3>
            <div class="grid grid-cols-2 gap-2 mb-2">
                <input type="number" id="exp-amount" placeholder="é‡‘é¡ (Â¥)" class="border p-2 rounded">
                <select id="exp-category" class="border p-2 rounded text-sm">
                    <option>äº¤é€š</option>
                    <option>ç¾é£Ÿ</option>
                    <option>è³¼ç‰©</option>
                    <option>ä»£è³¼</option>
                </select>
            </div>
            <input type="date" id="exp-date" class="border p-2 rounded w-full mb-2">
            <div class="flex items-center space-x-2 mb-3">
                <label class="bg-gray-100 flex-1 text-center py-2 rounded cursor-pointer text-sm border border-dashed border-gray-400">
                    <i class="fas fa-camera"></i> æ‹æ”¶æ“š
                    <input type="file" accept="image/*" capture="camera" class="hidden" onchange="handleReceipt(this)">
                </label>
                <div id="receipt-preview" class="w-10 h-10 bg-gray-200 rounded hidden"></div>
            </div>
            <button onclick="addExpense()" class="bg-blue-600 text-white w-full py-2 rounded font-bold">å„²å­˜ç´€éŒ„</button>
        </div>

        <div class="bg-white p-4 rounded-xl shadow">
            <h3 class="font-bold mb-2">æ¶ˆè²»æ¸…å–®</h3>
            <div id="expense-list" class="text-sm space-y-2"></div>
            <div class="mt-4 pt-2 border-t font-bold text-right text-red-600" id="total-amount">ç¸½è¨ˆ: Â¥0</div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 shadow-lg safe-area-bottom">
        <button onclick="switchTab('itinerary')" class="flex flex-col items-center text-blue-600"><i class="fas fa-calendar-day text-xl"></i><span class="text-xs">è¡Œç¨‹</span></button>
        <button onclick="switchTab('ledger')" class="flex flex-col items-center text-gray-400"><i class="fas fa-calculator text-xl"></i><span class="text-xs">è¨˜å¸³</span></button>
        <button onclick="switchTab('tickets')" class="flex flex-col items-center text-gray-400"><i class="fas fa-folder-open text-xl"></i><span class="text-xs">æ–‡ä»¶</span></button>
    </nav>

    <script>
        // è¡Œç¨‹è³‡æ–™ (æ ¹æ“š PDF æå–)
        const travelData = {
            1: {
                title: "2/2 (ä¸€) æŠµé” & è‡¨ç©ºåŸ",
                items: [
                    { time: "09:20", task: "âœˆï¸ æ¡ƒåœ’æ©Ÿå ´èµ·é£›", loc: "æ¡ƒåœ’æ©Ÿå ´" },
                    { time: "12:50", task: "æŠµé”é—œè¥¿æ©Ÿå ´ (KIX)", loc: "Kansai International Airport" },
                    { time: "14:00", task: "ğŸ›ï¸ è‡¨ç©ºåŸ Outlet", loc: "Rinku Premium Outlets" },
                    { time: "19:25", task: "ğŸ¨ Check-in", loc: "GRIDS PREMIUM HOTEL OSAKA NAMBA" },
                    { time: "19:30", task: "ğŸ± æ™šé¤ï¼šå¤§èµ·æ°´ç”¢", loc: "å¤§èµ·æ°´ç”¢ è¿´è½‰å£½å¸ é“é “å €åº—" }
                ]
            },
            2: {
                title: "2/3 (äºŒ) å¤©æ©‹ç«‹ä¸€æ—¥éŠ",
                items: [
                    { time: "06:40", task: "ğŸšŒ èŸ¹é“æ¨‚é›†åˆ", loc: "èŸ¹é“æ¨‚é“é “å €æ±åº—" },
                    { time: "10:00", task: "ğŸš¢ ä¼Šæ ¹ç£éŠè¦½èˆ¹", loc: "ä¼Šæ ¹ç£éŠè¦½èˆ¹" },
                    { time: "11:00", task: "ğŸš  å¤©æ©‹ç«‹å‚˜æ¾å…¬åœ’", loc: "å¤©æ©‹ç«‹å‚˜æ¾å…¬åœ’" },
                    { time: "14:45", task: "ğŸ¡ ç¾å±±èŒ…è‰å±‹ä¹‹é‡Œ", loc: "ç¾å±±èŒ…è‰å±‹ä¹‹é‡Œ" },
                    { time: "19:00", task: "ğŸ¨ Check-in", loc: "Hotel Hankyu RESPIRE OSAKA" }
                ]
            },
            3: {
                title: "2/4 (ä¸‰) è²´èˆ¹ç¥ç¤¾",
                items: [
                    { time: "12:40", task: "ğŸšƒ é˜ªæ€¥å‰å¾€äº¬éƒ½", loc: "é˜ªæ€¥å¤§é˜ªæ¢…ç”°ç«™" },
                    { time: "14:40", task: "â›©ï¸ è²´èˆ¹ç¥ç¤¾æ°´å åœ", loc: "è²´èˆ¹ç¥ç¤¾" },
                    { time: "16:30", task: "ğŸ“¸ é»ç‡ˆæ™‚æ®µæ‹ç…§", loc: "è²´èˆ¹ç¥ç¤¾" },
                    { time: "20:30", task: "ğŸ¥© æ™šé¤ï¼šç‡’è‚‰åŠ›ä¸¸", loc: "ç‡’è‚‰åŠ›ä¸¸ æ¢…ç”°æ±é€šåº—" }
                ]
            },
            4: {
                title: "2/5 (å››) å‹å°¾å¯º & å§¬è·¯åŸ",
                items: [
                    { time: "09:10", task: "ğŸ”´ å‹å°¾å¯º (é”æ‘©)", loc: "å‹å°¾å¯º" },
                    { time: "13:35", task: "ğŸ¯ å§¬è·¯åŸåƒè§€", loc: "å§¬è·¯åŸ" },
                    { time: "17:30", task: "ğŸ¨ å›åˆ°é£¯åº—", loc: "Hotel Hankyu RESPIRE OSAKA" }
                ]
            },
            5: {
                title: "2/6 (äº”) è³¦æ­¸",
                items: [
                    { time: "08:00", task: "ğŸš æ©Ÿå ´æ¥é€", loc: "Hotel Hankyu RESPIRE OSAKA" },
                    { time: "12:20", task: "âœˆï¸ é—œè¥¿æ©Ÿå ´èµ·é£›", loc: "Kansai International Airport" }
                ]
            }
        };

        // Tab åˆ‡æ›é‚è¼¯
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('nav button').forEach(el => el.classList.replace('text-blue-600', 'text-gray-400'));
            event.currentTarget.classList.replace('text-gray-400', 'text-blue-600');
            const titles = { itinerary: 'æ¯æ—¥è¡Œç¨‹', ledger: 'è¨˜å¸³å·¥å…·', tickets: 'æ–‡ä»¶åº«' };
            document.getElementById('page-title').innerText = titles[tabId];
        }

        // è¡Œç¨‹é¡¯ç¤ºé‚è¼¯
        function showDay(day) {
            const content = document.getElementById('day-content');
            const data = travelData[day];
            let html = `<div class="bg-blue-50 p-3 rounded-lg mb-4 text-blue-800 font-bold text-center">${data.title}</div>`;
            
            data.items.forEach(item => {
                html += `
                    <div class="flex items-start mb-4 bg-white p-3 rounded-lg shadow-sm">
                        <div class="w-16 text-sm font-bold text-gray-500 pt-1">${item.time}</div>
                        <div class="flex-1">
                            <div class="font-bold">${item.task}</div>
                            <button onclick="navigate('${item.loc}')" class="text-xs text-blue-500 mt-1"><i class="fas fa-location-arrow"></i> å°èˆªè‡³ ${item.loc}</button>
                        </div>
                    </div>`;
            });
            content.innerHTML = html;
            
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.day-btn').forEach((btn, idx) => {
                if(idx + 1 === day) btn.className = "day-btn bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-bold min-w-fit";
                else btn.className = "day-btn bg-white px-4 py-2 rounded-full text-sm min-w-fit border";
            });
        }

        function navigate(loc) {
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`, '_blank');
        }

        // è¨˜å¸³é‚è¼¯
        let expenses = JSON.parse(localStorage.getItem('travel_expenses')) || [];
        function addExpense() {
            const amount = document.getElementById('exp-amount').value;
            const category = document.getElementById('exp-category').value;
            const date = document.getElementById('exp-date').value;
            if(!amount || !date) return alert('è«‹è¼¸å…¥é‡‘é¡èˆ‡æ—¥æœŸ');
            
            const item = { id: Date.now(), amount, category, date, receipt: tempReceipt };
            expenses.push(item);
            localStorage.setItem('travel_expenses', JSON.stringify(expenses));
            renderExpenses();
            // é‡ç½®
            document.getElementById('exp-amount').value = '';
            document.getElementById('receipt-preview').classList.add('hidden');
            tempReceipt = null;
        }

        let tempReceipt = null;
        function handleReceipt(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                tempReceipt = e.target.result;
                const preview = document.getElementById('receipt-preview');
                preview.style.backgroundImage = `url(${tempReceipt})`;
                preview.style.backgroundSize = 'cover';
                preview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        function renderExpenses() {
            const list = document.getElementById('expense-list');
            let total = 0;
            list.innerHTML = expenses.map(ex => {
                total += parseInt(ex.amount);
                return `
                <div class="flex justify-between items-center border-b pb-2">
                    <div>
                        <span class="font-bold">Â¥${ex.amount}</span> 
                        <span class="text-xs bg-gray-100 px-1 rounded">${ex.category}</span>
                        <div class="text-[10px] text-gray-400">${ex.date}</div>
                    </div>
                    ${ex.receipt ? `<button onclick="showImg('${ex.receipt}')" class="text-blue-500 text-xs">æŸ¥çœ‹æ”¶æ“š</button>` : ''}
                    <button onclick="deleteExp(${ex.id})" class="text-red-400 text-xs ml-2">åˆªé™¤</button>
                </div>`;
            }).join('');
            document.getElementById('total-amount').innerText = `ç¸½è¨ˆ: Â¥${total}`;
        }

        function deleteExp(id) {
            expenses = expenses.filter(e => e.id !== id);
            localStorage.setItem('travel_expenses', JSON.stringify(expenses));
            renderExpenses();
        }

        function showImg(src) {
            const win = window.open("");
            win.document.write(`<img src="${src}" style="width:100%">`);
        }

        // åˆå§‹åŒ–
        showDay(1);
        renderExpenses();
        document.getElementById('exp-date').valueAsDate = new Date();
    </script>
</body>
</html>